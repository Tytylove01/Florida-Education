---
title: "Tampa"
execute:
  echo: false
  message: false
  warning: false
---


```{r}
# Load necessary libraries
library(tidycensus)
library(tidyverse)
library(leaflet)
library(sf)
library(viridis)

# Load your data
x <- read_rds("fl_data.rds")
```


```{r}

# Filter data for Hillsborough County (Tampa)
tampa_data <- x %>%
  filter(grepl("Hillsborough County", NAME))  # Filter rows where NAME contains "Hillsborough County"

# Ensure tampa_data is an sf object with geometry
if (!inherits(tampa_data, "sf")) {
  stop("tampa_data must be an sf object with geometry.")
}

# Define a color palette for the percentage of Doctorate degrees
pal <- colorNumeric(
  palette = "viridis",  # Use the "viridis" color scale
  domain = tampa_data$pct_doctorate  # Map to the pct_doctorate column
)

# Create the interactive Leaflet map
leaflet_map <- leaflet(tampa_data) %>%
  addTiles() %>%  # Add default OpenStreetMap tiles (street view)
  addProviderTiles(providers$Esri.WorldImagery, group = "Satellite View") %>%  # Add satellite view
  addPolygons(
    color = ~pal(pct_doctorate),  # Color polygons based on pct_doctorate
    weight = 1,                   # Border thickness
    opacity = 1,                  # Border opacity
    fillOpacity = 0.7,            # Fill opacity
    popup = ~paste(               # Popup text when clicking on a tract
      "Tract: ", NAME, "<br>",
      "Population: ", B01003_001, "<br>",
      "% Doctorate: ", round(pct_doctorate, 2), "%"
    ),
    highlightOptions = highlightOptions(
      weight = 2,                 # Highlight border thickness
      color = "white",            # Highlight border color
      fillOpacity = 0.9,          # Highlight fill opacity
      bringToFront = TRUE         # Bring highlighted tract to front
    )
  ) %>%
  addLayersControl(
    baseGroups = c("Street View", "Satellite View"),  # Layer control for switching views
    options = layersControlOptions(collapsed = FALSE)
  ) %>%
  addLegend(
    position = "bottomright",     # Position of the legend
    pal = pal,                    # Color palette
    values = ~pct_doctorate,      # Values for the legend
    title = "% Doctorate"         # Legend title
  ) %>%
  setView(lng = -82.4584, lat = 27.9506, zoom = 11)  # Set initial view to Tampa

# Display the map
leaflet_map

```


